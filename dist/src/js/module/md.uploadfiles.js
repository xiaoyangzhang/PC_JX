/*! pc_jx - v1.0.0 - 2016-07-28 */
define(function(require,exports,module){require("ajaxform"),$public=require("public"),$uploadfiles=function(){this.init.apply(this,arguments)},$uploadfiles.prototype={config:{curfilebox:null,upldclik:".upldclik",adpicfile:".adpicfile",single:".single",mult:".mult",plhd:".plhd",imgbox:".imgbox",del:".del",canclick:".canclick",groupimg:".groupimg",base_str:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},init:function(){var _self=this,temp_src="";$(_self.config.imgbox).find("img").filter(function(){temp_src=$(this).attr("src"),temp_src&&temp_src!=_self.config.base_str&&$(this).closest(_self.config.imgbox).addClass("imgbox-action").find(_self.config.upldclik).css("z-index",3)}),$(_self.config.canclick).click(function(){return!1}),$(_self.config.del).on("click",function(){return _self.delboximg(_self,this),!1}),$(_self.config.adpicfile).on("change",function(){return _self.addboximg(_self,this),!1})},uploadPic:function(img,fileObj){var $imgbox=$(img).closest("span"),_self=this;return $(fileObj).parent().wrap("<form id='uploadform' action='"+(fileuploadURL?fileuploadURL:"http://filegw.test.jiuxiulvxing.com/filegw/file/upload_string")+"' method='post' enctype='multipart/form-data'></form>"),$imgbox.find(_self.config.plhd).addClass("plhd-action"),$("#uploadform").ajaxSubmit({success:function(data){if($public.isLogin(data),data=JSON.parse(data),$("#uploadform").remove(),$(_self.config.plhd).removeClass("plhd-action"),$imgbox.append('<a class="upldclik"><input type="file" name="adpicfile" class="adpicfile"></a>'),$imgbox.find(".adpicfile").on("change",function(){_self.addboximg(_self,this)}),_self.config.curfilebox&&200==data.status){var $box=_self.config.curfilebox;$box.find("img").attr("src",data.data?img_domain+data.data:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="),$box.find(":hidden").val(data.data),$imgbox.addClass("imgbox-action"),_self.sucssinfo($imgbox),$imgbox.find(_self.config.upldclik).css("z-index",3)}else $public.dialog.msg(data.message,"error"),$imgbox.find(_self.config.upldclik).css("z-index",9)},error:function(err){$public.dialog.msg("请求发生错误！","error"),$("#uploadform").remove(),$(_self.config.plhd).removeClass("plhd-action"),$imgbox.append('<a class="upldclik"><input type="file" name="adpicfile" class="adpicfile"></a>'),$imgbox.find(".adpicfile").on("change",function(){_self.addboximg(_self,this)}),$imgbox.find(_self.config.upldclik).css("z-index",9)}}),this.config.curfilebox=$imgbox,!1},addboximg:function(_self,_this){var $imgbox=$(_this).closest(_self.config.imgbox),isPicture=$public.isPicture(_this,500);return $imgbox.parent().find(".Validform_checktip").remove(),!isPicture.status&&isPicture.content?_self.errorinfo($imgbox,isPicture.content):($imgbox.find("input").show(),_self.uploadPic($imgbox.find("img").get(0),_this)),!1},delboximg:function(_self,_this){var $imgbox=$(_this).closest(_self.config.imgbox);return $imgbox.find(_self.config.upldclik).css("z-index",9),$imgbox.removeClass("imgbox-action"),$imgbox.find("img").attr("src",_self.config.base_str),$imgbox.find(":hidden").val(""),$imgbox.find(_self.config.upldclik).show(),_self.errorinfo($imgbox,"请选择图片！"),!1},errorinfo:function($box,msg){var _self=this,isGroup=$box.attr("class").indexOf("cnat")!=-1,isAllowNull="";isGroup?(isAllowNull=$box.closest(_self.config.groupimg).attr("class").indexOf("allownull")!=-1,$box=$box.closest(_self.config.groupimg),$files=$box.find(":hidden"),
// for(var i=0;i<$files.length;i++){
// 	if($files[i].value!='') return;
// }
$box.find(".Validform_checktip").remove(),(!isAllowNull||isAllowNull&&"请选择图片！"!=msg)&&$box.append('<span class="Validform_checktip Validform_wrong">'+msg+"</span>")):(isAllowNull=$box.attr("class").indexOf("allownull")!=-1,$box.parent().find(".Validform_checktip").remove(),(!isAllowNull||isAllowNull&&"请选择图片！"!=msg)&&$box.after('<span class="Validform_checktip Validform_wrong">'+msg+"</span>"))},sucssinfo:function($box){var _self=this,isGroup=$box.attr("class").indexOf("cnat")!=-1;isGroup?($box=$box.closest(_self.config.groupimg),$box.find(".Validform_checktip").remove(),$box.append('<span class="Validform_checktip Validform_right"></span>')):($box.parent().find(".Validform_checktip").remove(),$box.after('<span class="Validform_checktip Validform_right"></span>'))}},module.exports=new $uploadfiles});
/*! pc_jx 最后修改于： 2016-07-28 */