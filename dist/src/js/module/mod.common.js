/*! pc_jx - v1.0.0 - 2016-07-28 */
define(function(require,exports,module){require("tmpl"),require("validform"),require("md5");var $public=function(){this.init.apply(this,arguments)};$public.prototype={init:function(){var $self=this;$self.timmer={},$self.setPlaceholder(),$self.comSelect(),$self.lineInteractive(),$self.scrollBanner({bannerId:"#scroll-banner"}),$self.saveFeedBack(),$self.loadIndexImages(),$self.setTopFixed(".details-list"),$self.scrollTourContent(),$self.screenBackTop(),$self.hoverText(),$self.buyActivity(),$self.setTextAreaNumber(),$self.immediately()},isUserLogin:function(options){var $self=this,config={cookieName:"token2",callback:function(){}},opts=$.extend(config,options),isLogin=(require("cookie"),!!$.cookie(opts.cookieName));isLogin?opts.callback():$self.showLoginWindow(opts.callback)},showLoginWindow:function(_callback){var $self=this;$self.closeWinFn&&$self.closeWinFn();var showWinCallback=function(){var loginName=$.cookie("loginName");loginName&&""!==loginName&&"null"!==loginName&&$("#loginname").val(loginName),$self.submitLoginEvent(_callback),$("#loginSubmitBtn").on("click",function(){return $self.avoidCntClick(function(){$("#loginForm").submit()},100,"winlogin"),!1})};$self.openWindowFn({width:640,height:400,frameId:"login-pop-frame",url:$("#loginWindow").val(),showCallback:showWinCallback})},submitLoginEvent:function(_callback){var $self=this,setUserName=function(){var loginName=$("#loginname").val(),checkBox=$("#loginForm .saveuser");if(checkBox.prop("checked")){var date=new Date;date.setTime(date.getTime()+36e5),$.cookie("loginName",loginName,{expires:date,path:"/"})}else $.cookie("loginName",null,{path:"/"})},sucCallback=function(json){if(!json.success)return $self.comAlert({msg:json.resultMsg,append:"#login-pop-frame",hideCallback:function(){$("#loginSubmitBtn").removeAttr("disabled")}}),!1;if($("#imgcode").val(""),$(".imgcode")[0].src=$("#root_path").val()+"/user/getImgCode?d="+Math.random(),
//setCookie();
setUserName(),$ajaxform.resetForm(),$("#login-pop-frame").remove(),_callback){var isok=_callback();return setTimeout(function(){$("#loginSubmitBtn").removeAttr("disabled")},500),isok}json.value?window.location.href=json.value:window.location.reload()},$ajaxform=$("#loginForm").Validform({tiptype:4,ajaxPost:!0,beforeCheck:function(){var username=$("#loginname").val(),password=$("#loginpwd").val();return""==username?($self.comAlert({msg:"请输入用户名",append:"#login-pop-frame"}),!1):""==password?($self.comAlert({msg:"请输入密码",append:"#login-pop-frame"}),!1):password.length<6?($self.comAlert({msg:"请输入6-20位密码",append:"#login-pop-frame"}),!1):void 0},beforeSubmit:function(form){$("#loginpwd").val(md5($("#loginpwd").val()))},callback:sucCallback});return!1},comSelect:function(){$(document).on("click",".ym-select span",function(){$(this).closest(".ym-select").css("z-index",100),$(".ym-select ul").hide(),$(this).next("ul").children().length>4?$(this).next("ul").css({height:184,overflow:"auto"}):$(this).next("ul").css({height:"auto"}),$(this).next("ul").show()}),$(document).on("click",".ym-select ul li",function(){var parent=$(this).closest("ul"),select=$(this).closest(".ym-select"),value=$(this).attr("data-value"),text=$(this).text();select.css("z-index",1),select.find("em").html(text),select.find("input[type='hidden']").val(0!=value?value:""),parent.hide()}),$(document).on("click",function(e){0==$(e.target).closest(".ym-select").length&&($(".ym-select").css("z-index",1),$(".ym-select ul").hide())})},comAlert:function(options){var opts=$.extend({type:!1,msg:"",//默认提示消息
showTime:2e3,//停顿时间
animationTime:500,append:!1,showCallback:function(){},//显示后的回调函数
hideCallback:function(){}},options),typeclass=opts.type?"ym-alert-sucess":"ym-alert-fail",appendto=opts.append?opts.append:"body",$html=$('<div class="ym-alert-fail">'+options.msg+"</div>");""==opts.append?$html.css("position","fixed"):$html.css("position","absolute"),$("."+typeclass).remove(),$html.appendTo(appendto);var hideEvent=function(){$("."+typeclass).fadeOut(opts.animationTime,opts.hideCallback)};$("."+typeclass).fadeIn(opts.animationTime,opts.showCallback),setTimeout(hideEvent,opts.showTime)},screenBackTop:function(options){var $self=this,_confing={backId:"#back-top",direction:"right",clickBtn:"a:first",offtop:0,offleft:0,boxWidth:1200,bottomOffSize:380},opts=$.extend(_confing,options),$backDom=$(opts.backId),$backWidth=$backDom.width(),$domWidth=($backDom.height(),$(document).width()),$domHeight=$(document).height(),$winHeight=$(window).height(),initBackTop=function(){var offWidth=document.all?20:0,offRight=($domWidth-opts.boxWidth-offWidth)/2-$backWidth;$backDom.css({right:offRight})},scrollEvent=function(){$self.avoidCntClick(function(){var scrollTop=$(this).scrollTop();scrollTop>$winHeight?$backDom.find("a:first").removeClass("hidden"):$backDom.find("a:first").addClass("hidden"),scrollTop>$domHeight-$winHeight-opts.bottomOffSize?$backDom.animate({bottom:opts.bottomOffSize},500):$backDom.animate({bottom:0},500)},100)};initBackTop(),$(window).on("scroll",scrollEvent),$backDom.find("a:first").on("click",function(){$("html,body").animate({scrollTop:0},500)})},scrollBanner:function(options){var _confing={bannerId:"#scroll-banner",isFullScreen:!0,width:1920,height:660,runtime:1e3,steptime:5e3,numDots:".dots",numOn:"active"},opts=$.extend(_confing,options),$scrollDom=$(opts.bannerId),$scrollUl=$scrollDom.find("ul"),$size=$scrollUl.find("li").size(),width=opts.isFullScreen?$scrollDom.find("img").width():opts.width;width=width>1920?1920:$scrollDom.find("img").width();var tt,index=(opts.isFullScreen?$scrollDom.find("img").height():opts.height,1),initScrollBanner=function(){$scrollUl.find("li").css({position:"absolute",left:0,top:0,bottom:0,right:0,"z-index":0,opacity:0}),$scrollUl.find("li:first").css({"z-index":1,opacity:1}),$(opts.numDots).find("li:first").addClass(opts.numOn),scrollStart()},runAnimate=function(eq){var _index=void 0!==eq?eq:index;_index>=$size&&(index=_index=0);var _current=$scrollUl.find("li:eq("+_index+")");_current.siblings().stop().animate({opacity:0,"z-index":0},opts.runtime),_current.stop().animate({opacity:1,"z-index":1},opts.runtime),$(opts.numDots).find("li:eq("+_index+")").addClass(opts.numOn).siblings("li").removeClass(opts.numOn),index++},scrollStart=function(){tt=window.setInterval(function(){runAnimate()},opts.steptime)};$scrollDom.on("mouseover",function(){window.clearInterval(tt)}),$scrollDom.on("mouseout",function(){scrollStart()}),$(opts.numDots).find("li").on("mouseover",function(){var eq=$(this).index();window.clearInterval(tt),runAnimate(eq)}),$(opts.numDots).find("li").on("mouseout",function(){scrollStart()}),initScrollBanner()},setTopFixed:function(dom,options){var $this=$(dom);if(0==$this.length)return!1;var config={top:0},inittop=$this.offset().top;$.extend(config,options),$this.css("position");$(window).on("scroll",function(){var scrolltop=$this.prev().length>0?$this.prev().offset().top:inittop,height=$this.prev().length>0?$this.outerHeight():0;return $(this).scrollTop()<=scrolltop+height?($this.removeAttr("style"),!1):void $this.css({position:"fixed",top:0,bottom:"auto",margin:0,width:$this.width(),"z-index":99})})},openWindowFn:function(options){var config={title:"",width:780,height:600,url:"",data:null,content:"",jsondata:{},frameId:"ym-pop-frame",closebtn:".close-pop-btn",showCallback:function(){},hideCallback:function(){}},opts=$.extend(config,options),doc_height=$(document).height(),win_height=$(window).height(),showWinEvent=function(){var style={width:opts.width,height:opts.height,"margin-left":-opts.width/2,"margin-top":-opts.height/2,display:"none","z-index":999,position:opts.height>win_height?"absolute":"fixed"};$("#"+opts.fr).remove(),$("#ym-doc-mask").remove(),$('<div id="ym-doc-mask"></div>').css({height:doc_height}).appendTo("body"),$('<div id="'+opts.frameId+'"></div>').css(style).appendTo("body"),$("#"+opts.frameId).append('<div class="ym-pop-hd"><span class="title">'+opts.title+'</span><em class="ym-pop-close close-pop-btn"></em></div>'),$("#"+opts.frameId).append('<div class="ym-pop-bd"></div>');var ajaxConfig={cache:!1,type:"get",url:opts.url,data:opts.data,success:function(html){$.template("template",html),$("#"+opts.frameId+" .ym-pop-bd").html($.tmpl("template",opts.jsondata))}};opts.url&&""!=opts.url?$.ajax(ajaxConfig):($.template("template",opts.content),$("#"+opts.frameId+" .ym-pop-bd").html($.tmpl("template",opts.jsondata))),$("#"+opts.frameId).fadeIn(300,opts.showCallback)},closeWinEvent=function(){$("#"+opts.frameId).fadeOut(300,function(){$("#ym-doc-mask").remove(),$(this).remove(),opts.hideCallback()})};showWinEvent(),this.closeWinFn=closeWinEvent,$(document).on("click",opts.closebtn,closeWinEvent)},saveFeedBack:function(){var $self=this;$("#feedbackform").Validform({tiptype:4,ajaxPost:!0,callback:function(json){return json.success?void $self.openWindowFn({width:596,height:378,title:"温馨提示",url:$("#win-feedback").val(),hideCallback:function(){window.location.reload()}}):($self.comAlert({msg:json.resultMsg}),!1)}});$("#feedbackform-submit").on("click",function(){return $("#feedbackform").submit(),!1})},lineInteractive:function(){$("#ym-tour ul li").hover(function(){var icon=$(this).find("i.icon-tool");return icon.hasClass("air")?(icon.addClass("air-on"),!1):icon.hasClass("bus")?(icon.addClass("bus-on"),!1):icon.hasClass("train")?(icon.addClass("train-on"),!1):icon.hasClass("ship")?(icon.addClass("ship-on"),!1):void 0},function(){var icon=$(this).find("i.icon-tool");return icon.hasClass("air")?(icon.removeClass("air-on"),!1):icon.hasClass("bus")?(icon.removeClass("bus-on"),!1):icon.hasClass("train")?(icon.removeClass("train-on"),!1):icon.hasClass("ship")?(icon.removeClass("ship-on"),!1):void 0}),$("#ym-tour ul li > .content").each(function(){var _height=$(this).height();_height>530?$(this).addClass("hidden"):$(this).closest("li").find("a.more").remove()}),$("#ym-tour ul li > a.more").on("click",function(){$(this).attr("open")?($(this).siblings(".content").addClass("hidden"),$(this).attr("open",!1).text("more")):($(this).siblings(".content").removeClass("hidden"),$(this).attr("open",!0).text("close"))})},loadIndexImages:function(){var lock=!0,$firstbox=$('<div id="content_0" class="clearfix"></div>');$firstbox.css({position:"absolute","z-index":1,opacity:1,left:0,top:0,right:0,bottom:0}),$("#loadarea").css({position:"relative"}).wrapInner($firstbox),$(".tab-lan ul li").on("click",function(){var ajaxurl=$(this).attr("ajaxurl"),index=$(this).index();return!($(this).find("span").hasClass("on")||!lock)&&(lock=!1,$(this).find("span").addClass("on"),$(this).siblings().find("span").removeClass("on"),$("#content_"+index).length>0?($("#content_"+index).siblings().animate({"z-index":0,opacity:0},400),$("#content_"+index).stop().animate({"z-index":1,opacity:1},800,function(){lock=!0}),!1):($.get(ajaxurl,{t:(new Date).getTime()},function(html){var $box=$('<div id="content_'+index+'"></div>');$box.css({position:"absolute","z-index":0,opacity:0,left:0,top:0,right:0,bottom:0}).html(html),$("#loadarea").append($box),$("#content_"+index).siblings().animate({"z-index":0,opacity:0},400),$("#content_"+index).stop().animate({"z-index":1,opacity:1},800,function(){lock=!0})}),!1))})},scrollTourContent:function(){$(".details-list ul li").click(function(event){var $this=$(this),index=$this.index(),offtop=$("#a"+(index+1)).offset().top,difftop=$(this).height();return $("html,body").animate({scrollTop:offtop-difftop},500,function(){$this.addClass("on"),$this.siblings().removeClass("on")}),!1}),$(window).on("scroll",function(){var $this=$(this);$(".details-list").height();if($("#a1,#a2,#a3").each(function(i){var difftop=$this.scrollTop()-$(this).offset().top;if(difftop>=0&&difftop<=$(window).height()/3)return $(".details-list ul li:eq("+i+")").addClass("on").siblings().removeClass("on"),!1}),$this.scrollTop()==$(document).height()-$(window).height())return $(".details-list ul li:last").addClass("on").siblings().removeClass("on"),!1})},hoverText:function(){$(document).on("mouseover",".membertab ol li a",function(){var $this=$(this),$prent=$this.find("p strong"),textHeight=($this.find("p em"),$this.find("p em").height());return textHeight>24&&$prent.stop().animate({height:textHeight,padding:"10px 0"},300),!1}),$(document).on("mouseout",".membertab ol li a",function(){var $this=$(this),$prent=$this.find("p strong");return $prent.stop().animate({height:24,padding:0},300),!1})},immediately:function(){$("#lk-immediately").on("click",function(){return $("body").append("<div id='mask' class='mask'></div>"),$("#immediately").fadeIn("slow"),!1}),
//关闭
$(".bm-close").on("click",function(){return $("#immediately").fadeOut("fast"),$("#mask").hide().remove(),!1})},buyActivity:function(){var $self=this;$("#buyActBtn").on("click",function(){var link=$(this).attr("href");return $self.isUserLogin({callback:function(){window.location.href=link}}),!1})},avoidCntClick:function(callback,wait,id){var $self=this,_id=id||"flag";return $self[_id]&&(window.clearTimeout($self[_id]),delete $self[_id]),$self[_id]=window.setTimeout(function(){callback(),delete $self[_id]},wait,_id)},setProNumber:function(dom,options){var _self=this,$this=$(dom);if(0==$this.length)return!1;var config={clickBtn:[".minus",".add"],grayBtn:"on",numInput:".num",initVal:0,callback:function(){}},opts=$.extend(config,options),setBtnState=function(){$("span[pid]").each(function(){var _input=$(this).find(opts.numInput),_inputVal=parseInt(_input.val()),_minus=_input.siblings(opts.clickBtn[0]),_add=_input.siblings(opts.clickBtn[1]),_maxnum=_input.attr("maxnum")?parseInt(_input.attr("maxnum")):99;_inputVal<=opts.initVal?_minus.addClass(opts.grayBtn):_minus.removeClass(opts.grayBtn),_inputVal>=_maxnum?_add.addClass(opts.grayBtn):_add.removeClass(opts.grayBtn)})},clickBtnEvent=function(){var _parent=$(this).parent("span"),_parentid=_parent.attr("pid"),_input=$(this).siblings(opts.numInput),_value=!!_input.attr("data-value")&&JSON.parse(_input.attr("data-value")),_num=parseInt(_input.val());return!$(this).hasClass(opts.grayBtn)&&($(this).hasClass(opts.clickBtn[0].substr(1))?_num--:_num++,$("span[pid='"+_parentid+"']").each(function(){var _input=$(this).find(opts.numInput),_minus=_input.siblings(opts.clickBtn[0]),_add=_input.siblings(opts.clickBtn[1]),_maxnum=_input.attr("maxnum")?parseInt(_input.attr("maxnum")):99;_num<=opts.initVal?(_minus.addClass(opts.grayBtn),_add.removeClass(opts.grayBtn)):_num>=_maxnum?(_num=_maxnum,_add.addClass(opts.grayBtn),_minus.removeClass(opts.grayBtn)):(_add.removeClass(opts.grayBtn),_minus.removeClass(opts.grayBtn)),_input.val(_num)}),opts.callback(_value,_num,_parent,_self),!1)},inputEvent=function(){var _parent=$(this).closest("span"),_minus=(_parent.attr("pid"),_parent.find(opts.clickBtn[0])),_add=_parent.find(opts.clickBtn[1]),_input=_parent.find(opts.numInput),_maxnum=$(this).attr("maxnum")?parseInt($(this).attr("maxnum")):99,_currval=$(this).val(),_value=!!$(this).attr("data-value")&&JSON.parse($(this).attr("data-value")),_num=_currval,_isNumber=!(!/^[1-9]+[0-9]*]*$/.test(_currval)&&_currval!==opts.initVal||""===_currval);return _isNumber?parseInt(_currval)==opts.initVal?(setTimeout(function(){_input.blur(),opts.callback(_value,_num,_parent,_self)},600),!1):parseInt(_currval)>_maxnum?(_input.val(_maxnum),_minus.removeClass(opts.grayBtn),_add.addClass(opts.grayBtn),_num=_maxnum,setTimeout(function(){_input.blur(),opts.callback(_value,_num,_parent,_self)},600),!1):parseInt(_currval)>opts.initVal&&parseInt(_currval)<_maxnum?(_minus.removeClass(opts.grayBtn),_add.removeClass(opts.grayBtn),setTimeout(function(){_input.blur(),opts.callback(_value,_num,_parent,_self)},600),!1):void 0:(_input.val(opts.initVal),_minus.addClass(opts.grayBtn),_maxnum>opts.initVal?_add.removeClass(opts.grayBtn):_add.addClass(opts.grayBtn),_num=opts.initVal,setTimeout(function(){_input.blur(),opts.callback(_value,_num,_parent,_self)},600),!1)},btnArr=opts.clickBtn.join(",");setBtnState(),$this.on("click",btnArr,clickBtnEvent),$(opts.numInput).on("input propertychange",inputEvent),$this.on("click",opts.numInput,function(){$(this).select()}),$this.on("selectstart",btnArr,function(){return!1})},getValidCode:function(options){var config={runtime:60,disabled:"disabled",clickbtn:"#get-vcode",ajaxurl:"",initText:"获取短信验证码",disabledText:"重新获取",imgcode:"#imgcode",phone:"#regmobile",befCallback:function(){},sendCallback:function(){}},opts=$.extend(config,options),clickBtnEvent=function(){var mobileRule=/^1[0-9]{10}$/,mobileValue=$.trim($(opts.phone).val()),imgCodeRule=/^[^\s]{4,4}$/,imgCodeValue=$.trim($(opts.imgcode).val()),$this=$(this),ajaxurl=$this.attr("sendurl"),phonename=$(opts.phone).attr("name"),imgcodes=$(opts.imgcode).attr("name");if($this.attr("disabled"))return!1;if(""==mobileValue){var msg=$(opts.phone).attr("nullmsg");return $(opts.phone).siblings("span.Validform_checktip").text(msg).addClass("Validform_wrong"),!1}if(!mobileRule.test(mobileValue)){var msg=$(opts.phone).attr("errormsg");return $(opts.phone).siblings("span.Validform_checktip").text(msg).addClass("Validform_wrong"),!1}if(""==imgCodeValue){var msg=$(opts.imgcode).attr("nullmsg");return $(opts.imgcode).siblings("span.Validform_checktip").text(msg).addClass("Validform_wrong"),!1}if(!imgCodeRule.test(imgCodeValue)){var msg=$(opts.imgcode).attr("errormsg");return $(opts.imgcode).siblings("span.Validform_checktip").text(msg).addClass("Validform_wrong"),!1}var data={};data[phonename]=mobileValue,data[imgcodes]=imgCodeValue,data.t=(new Date).getTime();var sendAjaxEvent=function(json){var isok=opts.sendCallback(json,$this);if(!isok)return $("#imgcode").val(""),$(".imgcode")[0].src=$("#root_path").val()+"/user/getImgCode?d="+Math.random(),!1;var rurntime=$this.attr("runtime")?parseInt($this.attr("runtime")):opts.runtime,tt=window.setInterval(function(){if(rurntime--,$this.text(opts.disabledText+"("+rurntime+")"),rurntime<=0)return $this.removeAttr("disabled").removeClass("disabled").text(opts.initText),window.clearInterval(tt),!1},1e3);$this.attr("disabled","disabled").addClass("disabled")};return $.post(ajaxurl,data,sendAjaxEvent),!1};$(opts.clickbtn).on("click",clickBtnEvent)},setPlaceholder:function(){return!("placeholder"in document.createElement("input"))&&($("[placeholder]").each(function(){var inputType=$(this).attr("type"),width=$(this).outerWidth(),height=$(this).outerHeight(),left=$(this).position().left,top=$(this).position().top,padding=$(this).innerWidth()-$(this).width();$placeholder=$(this).css("color","#a9a9a9").attr("placeholder"),"text"==inputType&&$(this).val($placeholder),"password"==inputType&&($(this).parent().css({position:"relative","z-index":1}),$("<div>"+$placeholder+"</div>").css({display:"block",color:"#a9a9a9","font-size":"16px",position:"absolute",cursor:"text","z-index":10,left:left+"px",top:top+"px",width:width-padding+"px",height:height+"px","line-height":height+"px",padding:"0 "+padding/2+"px"}).on("click",function(){$(this).hide().prev().focus()}).insertAfter($(this)))}),$("[placeholder]").on("focus",function(){var inputType=$(this).attr("type"),$val=$(this).val(),$placeholder=$(this).attr("placeholder");$val==$placeholder&&"text"==inputType&&$(this).css("color","").val(""),"password"==inputType&&$(this).next().css("display","none")}),$("[placeholder]").on("blur",function(){var inputType=$(this).attr("type"),$val=$(this).val(),$placeholder=$(this).attr("placeholder");""==$val&&"text"==inputType&&$(this).css("color","#999").val($placeholder),""==$val&&"password"==inputType&&$(this).next().css("display","block")}),void $(document).on("submit","form",function(){$(this).find("[placeholder]").each(function(){var $val=$(this).val(),$placeholder=$(this).attr("placeholder");$val==$placeholder&&$(this).val("")})}))},setTextAreaNumber:function(){$("textarea[max-length]").on("input propertychange",function(){var textVal=$.trim($(this).val()),maxLen=$(this).attr("max-length");textVal.length>parseInt(maxLen)?($(this).val(textVal.substr(0,maxLen)),$(this).next("p").html("您还可以输入<em>0</em>个字")):$(this).next("p").html("您还可以输入<em>"+(maxLen-textVal.length)+"</em>个字")})},formatCurrency:function(num){num=num.toString().replace(/\$|\,/g,""),isNaN(num)&&(num="0"),sign=num==(num=Math.abs(num)),num=Math.floor(100*num+.50000000001),cents=num%100,num=Math.floor(num/100).toString(),cents<10&&(cents="0"+cents);for(var i=0;i<Math.floor((num.length-(1+i))/3);i++)num=num.substring(0,num.length-(4*i+3))+","+num.substring(num.length-(4*i+3));return(sign?"":"-")+num+"."+cents}},module.exports=new $public});
/*! pc_jx 最后修改于： 2016-07-28 */