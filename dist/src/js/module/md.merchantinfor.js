/*! pc_jx - v1.0.0 - 2016-07-28 */
define(function(require,exports,module){require("core"),require("widget"),require("datepicker"),//引用时间组件
require("uploadfiles"),//上传文件组件
require("validform"),//上传文件组件
require("dropdownlist"),//下拉框组件
require("upload"),$public=require("public"),$test=function(){this.init.apply(this,arguments)};var isLock=!0;$test.prototype={init:function(){var _self=this;if($("#forminfo").Validform(),
//渲染时间控件s
// $( "#tm" ).datepicker();
$("#bank").selectlist({width:200}),$("#card").selectlist({width:200,onChange:function(){isLock||$("#cardtxt").removeClass("Validform_error").val("").next().empty().removeClass("Validform_wrong Validform_right"),_self.changevalid(!0)}}),_self.changevalid(),
//渲染下拉框控件
$("select").selectlist({zIndex:10,width:200,height:32,onChange:function(){}}),$(".error_box").length>0){var tit_top=$(".error_box").offset().top,lock=!1;$(window).scroll(function(){var cur_top=$(this).scrollTop();tit_top<cur_top&&!lock?($(".error_box").css({position:"fixed",right:($(document).width()-1190)/2+0+"px"}),lock=!0):tit_top>cur_top&&lock&&($(".error_box").css({position:"absolute",right:"0px"}),lock=!1)})}var validoptions={tiptype:3,label:".label",showAllError:!0,datatype:{tax:/^[\w\W]{1,25}$/,name:/^[\w\W]{2,10}$/},ajaxPost:!0},rule=[{ele:".taxL",datatype:"tax",nullmsg:"请填写信息",errormsg:"请填写1到25位字符！"},{ele:".zrname",datatype:"name",nullmsg:"请填写信息",errormsg:"请填写2到10位字符！"}],validfm=$(".registerform").Validform(validoptions).addRule(rule);$(".comtype input[type='radio']").on("click",function(){$.ajax({type:"post",url:$public.urlpath.getBsScope,data:{merchantCategoryId:$(this).val()},success:function(data){var list=JSON.parse(data.value);$('input[type="checkbox"]').prop("checked","").prop("disabled","disabled"),$('input[type="checkbox"]:disabled').each(function(){for(var i=0;i<list.length;i++)$(this).val()==list[i].businessScopeId&&$(this).prop("disabled","")});var subDisabled=$('div.bomb input[type="checkbox"]:disabled');subDisabled.length<$('div.aaa input[type="checkbox"]').length&&$(".k1").prop("disabled","")}})}),$(".subt").on("click",function(){var selectvalid=$public.selectvalid(),groupimgvalid=$public.groupimgvalid($(".groupimg"),"请选择图片！"),allimgvalid=$public.allimgvalid($(".panel").find('.imgbox:not(".cnat")')),subpath=$(".subpath").val(),params=$public.paramcompare($("#forminfo").serializeArray(),function(data){data.saleScope=data.saleScope.replace(/\r\n/g,"\n")});/*console.log(JSON.stringify(params));*/
if(validfm.check()&&allimgvalid&&selectvalid&&groupimgvalid){$public.dialog.waiting();/*把从后台去的数据转换成数组*/
var idStr="";$("input[name='businessScopeId']:checked").each(function(){idStr+=$(this).val()+","}),params.scopeIds=idStr.substring(0,idStr.length-1),delete params.lxs,$.post(subpath,params,function(data){$public.isLogin(data),$public.dialog.closebox(),data.success?($public.dialog.msg("保存成功！","success"),setTimeout(function(){window.location.href=data.value},1500)):$public.dialog.msg(data.resultMsg,"error")})}return!1}),$(".ccc").change(function(){$(".company input[type='radio']").eq(0).prop("checked","checked")}),$(".k1").change(function(){$(this).prop("checked")?($(this).prop("checked","checked"),$(".aaa input[type='checkbox']").eq(0).prop("checked","checked")):($(this).prop("checked",""),$(".aaa input[type='checkbox']").prop("checked",""))}),$(".qdlm input[type='checkbox']").change(function(){_self.yanzheng()}),$(".aaa input[type='checkbox']").change(function(){_self.checkedstate()}),$(".ddd").change(function(){$(".ccc").prop("checked","")}),$(".company input[type='radio']").change(function(){$(".ccc").prop("checked","checked"),$(this).is(":checked")?$(".ccc").prop("checked","checked"):$(".ccc").prop("checked","")}),$(".comtype input[type='radio']").change(function(){_self.comtypedisabled()}),$(".rule-name").on("click",function(){$(".big-box").show()}),$(".close").on("click",function(){$(".big-box").hide()}),$public.actiondata("province","city"),_self.checkedstate(),_self.comtypedisabled()},changevalid:function(isTrue){var cardvalue=$("#card :hidden").val();isTrue&&(isLock=!1),0==cardvalue?$("#cardtxt").attr("datatype","card"):1==cardvalue?$("#cardtxt").attr("datatype","dlic"):2==cardvalue?$("#cardtxt").attr("datatype","psport"):3==cardvalue&&$("#cardtxt").attr("datatype","gidcard")},checkedstate:function(){var lxtu=$(".aaa input[type='checkbox']:checked").length;lxtu<1?$(".k1").prop("checked",""):$(".k1").prop("checked","checked")},comtypedisabled:function(){$(".daible").is(":checked")?$(".dised").prop("disabled","disabled").siblings(".disedli").prop("checked","checked"):$(".dised").prop("disabled",""),$(".ts").is(":checked")?$(".dised").prop("checked","checked").siblings(".disedli").prop("disabled","disabled"):$(".disedli").prop("disabled","")},yanzheng:function(){$(".qdlm input[type='checkbox']").is(":checked")?(
//alert('打上对勾');
$(".qdlm").find(".Validform_checktip").addClass("Validform_right").html(""),$(".qdlm").find(".Validform_checktip").removeClass("Validform_wrong").html("")):
//alert('打上x');
$(".qdlm").find(".Validform_checktip").addClass("Validform_wrong").html("请选择")}},$(function(){var merchantCategoryId=$(".comtype input[name='merchantCategoryId']:checked").val();return!!merchantCategoryId&&void $.ajax({type:"post",url:$public.urlpath.getBsScope,data:{merchantCategoryId:merchantCategoryId},success:function(data){var list=JSON.parse(data.value);$('input[type="checkbox"]').not("input:checked").prop("disabled","disabled"),
//$('.k1').prop("disabled","");
$('input[type="checkbox"]:disabled').each(function(){for(var i=0;i<list.length;i++)$(this).val()==list[i].businessScopeId&&$(this).prop("disabled","")});var subDisabled=$('div.bomb input[type="checkbox"]:disabled');subDisabled.length<$('div.aaa input[type="checkbox"]').length&&$(".k1").prop("disabled","")}})}),module.exports=new $test});
/*! pc_jx 最后修改于： 2016-07-28 */